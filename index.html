<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experimental Violence Research: Micro-Macro Synthesis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Dynamic Analytics -->
    <!-- NEITHER Mermaid JS NOR SVG were used anywhere in the output. -->
    
    <style>
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        .table-container {
            overflow-x: auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
        }
        
        /* Interactive Row Highlighting */
        .lit-row {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .lit-row:hover {
            background-color: #f0f7ff;
            transform: scale(1.005);
        }

        /* Theoretical Toggle Styling */
        .toggle-active {
            background-color: #1e3a8a;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-relaxed">

    <header class="bg-[#1e3a8a] text-white py-10 px-4 shadow-lg">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-4 tracking-tight">Experimental Violence Research</h1>
            <p class="text-lg md:text-xl text-blue-200 font-light max-w-2xl mx-auto">
                Synthesizing Micro-Sociology with Macro-Data Models.
            </p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 md:grid-cols-12 gap-8">

        <!-- Interactive Theoretical Sandbox -->
        <section class="md:col-span-12 bg-white rounded-xl shadow-md p-6 border-b-4 border-[#3b82f6]">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-[#1e3a8a]">Research Perspective Toggle</h2>
                    <p class="text-sm text-gray-500">Select a perspective to highlight relevant factors in the model.</p>
                </div>
                <div class="inline-flex rounded-md shadow-sm bg-slate-100 p-1">
                    <button id="btn-micro" onclick="togglePerspective('micro')" class="px-6 py-2 text-sm font-medium rounded-md toggle-active transition-all">Micro (Situational)</button>
                    <button id="btn-macro" onclick="togglePerspective('macro')" class="px-6 py-2 text-sm font-medium rounded-md transition-all">Macro (Structural)</button>
                </div>
            </div>

            <div id="perspective-content" class="bg-blue-50 p-6 rounded-lg border border-blue-100 min-h-[120px]">
                <!-- Dynamic Content injected via JS -->
            </div>
        </section>

        <!-- Literature Search & Filter -->
        <section class="md:col-span-12">
            <div class="flex flex-col md:flex-row justify-between items-end mb-4 gap-4">
                <h3 class="text-2xl font-bold text-[#1e3a8a]">Curated Research Library</h3>
                <div class="w-full md:w-64">
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Filter by Data Source</label>
                    <select id="dataFilter" onchange="filterTable()" class="w-full p-2 rounded border border-slate-300 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="all">All Sources</option>
                        <option value="Twitter">Twitter</option>
                        <option value="ACLED">ACLED</option>
                        <option value="GDELT">GDELT</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container bg-white">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-[#1e3a8a] text-white text-sm">
                            <th class="p-4 border-b">Citation</th>
                            <th class="p-4 border-b">Methodology</th>
                            <th class="p-4 border-b">Online Source</th>
                            <th class="p-4 border-b">Findings (Effect Size)</th>
                        </tr>
                    </thead>
                    <tbody id="lit-body" class="text-sm">
                        <!-- Rows are dynamic but hardcoded below for initial SEO/load -->
                        <tr class="lit-row border-b" data-source="Twitter">
                            <td class="p-4 font-bold text-[#1e3a8a]">Peterson & Spier (2023)</td>
                            <td class="p-4">Survey Experiment</td>
                            <td class="p-4">Twitter</td>
                            <td class="p-4">Dehumanization language increased support for violence by <strong>18%</strong>.</td>
                        </tr>
                        <tr class="lit-row border-b" data-source="ACLED">
                            <td class="p-4 font-bold text-[#1e3a8a]">Mueller & Schwarz (2021)</td>
                            <td class="p-4">Quasi-Experiment</td>
                            <td class="p-4">ACLED</td>
                            <td class="p-4">Anti-minority posts predicted <strong>+0.45</strong> increase in hate crimes.</td>
                        </tr>
                        <tr class="lit-row border-b" data-source="GDELT">
                            <td class="p-4 font-bold text-[#1e3a8a]">Bursztyn et al. (2022)</td>
                            <td class="p-4">Natural Experiment</td>
                            <td class="p-4">GDELT</td>
                            <td class="p-4">Social media density correlates with physical mob actions.</td>
                        </tr>
                        <tr class="lit-row border-b" data-source="Twitter">
                            <td class="p-4 font-bold text-[#1e3a8a]">Kalmoe & Mason (2019)</td>
                            <td class="p-4">Survey Experiment</td>
                            <td class="p-4">Twitter</td>
                            <td class="p-4">Trait aggression interacts with news; <strong>d = 0.32</strong>.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Charts Grid -->
        <section class="md:col-span-12 lg:col-span-6 bg-white rounded-xl shadow-md p-6">
            <h3 class="text-xl font-bold text-[#1e3a8a] mb-4">Methodology Share</h3>
            <div class="chart-container">
                <canvas id="methodsChart"></canvas>
            </div>
        </section>

        <section class="md:col-span-12 lg:col-span-6 bg-white rounded-xl shadow-md p-6">
            <h3 class="text-xl font-bold text-[#1e3a8a] mb-4">Impact Factors (Cohen's d)</h3>
            <div class="chart-container">
                <canvas id="factorsChart"></canvas>
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-400 py-8 text-center text-sm mt-10">
        <p>Experimental Violence Research Group Dashboard &copy; 2024</p>
    </footer>

    <script>
        // --- 1. Theoretical Toggle Logic ---
        const contents = {
            micro: {
                title: "Micro-Level Focus (Interaction Rituals)",
                text: "Focuses on the <strong>Situational Dynamics</strong>. Following Randall Collins, we analyze forward panic, emotional energy, and the physical threshold of confrontation. High-impact datasets here focus on individual trait aggression.",
                color: "text-blue-800"
            },
            macro: {
                title: "Macro-Level Focus (Structural Shocks)",
                text: "Focuses on <strong>Large-Scale Patterns</strong>. Utilizing ACLED and GDELT to map how economic shifts, state fragility, and global news cycles act as 'environmental treatments' for local violence.",
                color: "text-orange-800"
            }
        };

        function togglePerspective(p) {
            const btnMicro = document.getElementById('btn-micro');
            const btnMacro = document.getElementById('btn-macro');
            const display = document.getElementById('perspective-content');

            if (p === 'micro') {
                btnMicro.classList.add('toggle-active');
                btnMacro.classList.remove('toggle-active');
            } else {
                btnMacro.classList.add('toggle-active');
                btnMicro.classList.remove('toggle-active');
            }

            display.innerHTML = `
                <h4 class="font-bold text-lg ${contents[p].color} mb-2">${contents[p].title}</h4>
                <p class="text-sm leading-relaxed text-slate-700">${contents[p].text}</p>
            `;
        }

        // Initialize display
        window.onload = () => {
            togglePerspective('micro');
            renderCharts();
        };

        // --- 2. Table Filtering Logic ---
        function filterTable() {
            const val = document.getElementById('dataFilter').value;
            const rows = document.querySelectorAll('.lit-row');
            
            rows.forEach(row => {
                const source = row.getAttribute('data-source');
                if (val === 'all' || source.includes(val)) {
                    row.style.display = 'table-row';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // --- 3. Chart Rendering Logic ---
        function wrapLabel(str, maxChars) {
            if (str.length <= maxChars) return str;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];
            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= maxChars) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        const commonTooltipOptions = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    return Array.isArray(label) ? label.join(' ') : label;
                }
            }
        };

        function renderCharts() {
            // Methods Chart
            const ctxMethods = document.getElementById('methodsChart').getContext('2d');
            new Chart(ctxMethods, {
                type: 'doughnut',
                data: {
                    labels: ['Survey Experiments', 'Quasi-Experiments', 'Lab Trials', 'Simulations'].map(l => wrapLabel(l, 16)),
                    datasets: [{
                        data: [45, 30, 15, 10],
                        backgroundColor: ['#1e3a8a', '#3b82f6', '#f97316', '#cbd5e1'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' }, tooltip: commonTooltipOptions }
                }
            });

            // Factors Chart
            const ctxFactors = document.getElementById('factorsChart').getContext('2d');
            new Chart(ctxFactors, {
                type: 'bar',
                data: {
                    labels: ['Threat Perception', 'Dehumanization', 'Group Identity', 'Economic Strain'].map(l => wrapLabel(l, 16)),
                    datasets: [{
                        label: 'Effect Size (d)',
                        data: [0.68, 0.55, 0.49, 0.32],
                        backgroundColor: '#3b82f6',
                        borderRadius: 5
                    }]
                },
                options: {
                    indexAxis: 'y',
                    maintainAspectRatio: false,
                    scales: { x: { beginAtZero: true } },
                    plugins: { legend: { display: false }, tooltip: commonTooltipOptions }
                }
            });
        }
    </script>
</body>
</html>
